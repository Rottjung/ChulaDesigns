<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brood Bakery Calculator</title>
  <style>
    body { font-family: sans-serif; background: #fffbf5; padding: 2rem; }
    select, input { font-size: 1rem; padding: 0.25rem; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h1>Brood Bakery Calculator</h1><label for="recipeSelect">Choose Recipe:</label> <select id="recipeSelect"></select>

<br><br>

<label for="inputType">Input Type:</label> <select id="inputType"> <option value="dough">Total Dough Weight</option> <option value="flour">Flour Only</option> </select> <input type="number" id="inputAmount" value="1000"> g

  <h2>Ingredients</h2>
  <table id="ingredientTable">
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Amount (g)</th>
        <th>Brand</th>
        <th>Cost (THB)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <h2>Extras (per item)</h2>
  <table id="extrasTable">
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Grams per Item</th>
        <th>Brand</th>
        <th>Cost per Item (THB)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <h2 id="totalCost">Total Ingredient Cost: 0 THB</h2>  <script>
    let recipes = {}, prices = {};

    async function loadJSON(filename) {
      const res = await fetch(filename);
      return res.json();
    }

    function populateRecipes() {
      const recipeSelect = document.getElementById("recipeSelect");
      for (const recipeName in recipes) {
        const opt = document.createElement("option");
        opt.value = recipeName;
        opt.textContent = recipeName;
        recipeSelect.appendChild(opt);
      }
    }

    function updateTable() {
      const recipeName = document.getElementById("recipeSelect").value;
      const inputType = document.getElementById("inputType").value;
      const inputAmount = parseFloat(document.getElementById("inputAmount").value);
      const tbody = document.querySelector("#ingredientTable tbody");
      const extrasBody = document.querySelector("#extrasTable tbody");
      tbody.innerHTML = "";
      extrasBody.innerHTML = "";

      const recipe = recipes[recipeName];
      let totalPercent = 0;

      for (const ing of recipe.ingredients) {
        totalPercent += parseFloat(ing.bakersPercent);
      }

      let totalCost = 0;

      for (const ing of recipe.ingredients) {
        const percent = parseFloat(ing.bakersPercent);
        const baseAmount = (inputType === "dough")
          ? inputAmount * (percent / totalPercent)
          : inputAmount * (percent / 100);

        const brand = ing.brand || "";
        const priceEntry = prices[ing.ingredient]?.brands?.[brand] || prices[ing.ingredient]?.pricePerKg || 0;
        const pricePerGram = priceEntry / 1000;
        const cost = baseAmount * pricePerGram;
        totalCost += cost;

        const row = `<tr><td>${ing.ingredient}</td><td>${baseAmount.toFixed(1)}</td><td>${brand}</td><td>${cost.toFixed(2)}</td></tr>`;
        tbody.innerHTML += row;
      }

      for (const extra of recipe.extras || []) {
        const brand = extra.brand || "";
        const priceEntry = prices[extra.ingredient]?.brands?.[brand] || prices[extra.ingredient]?.pricePerKg || 0;
        const pricePerGram = priceEntry / 1000;
        const cost = extra.grams * pricePerGram;

        const row = `<tr><td>${extra.ingredient}</td><td>${extra.grams}</td><td>${brand}</td><td>${cost.toFixed(2)}</td></tr>`;
        extrasBody.innerHTML += row;
      }

      document.getElementById("totalCost").textContent = `Total Ingredient Cost: ${totalCost.toFixed(2)} THB`;
    }

    async function init() {
      [recipes, prices] = await Promise.all([
        loadJSON("recipes.json"),
        loadJSON("ingredientPrices.json")
      ]);
      populateRecipes();
      updateTable();
    }

    document.getElementById("recipeSelect").addEventListener("change", updateTable);
    document.getElementById("inputType").addEventListener("change", updateTable);
    document.getElementById("inputAmount").addEventListener("input", updateTable);

    init();
  </script></body>
</html>
