<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brood Bakery App</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    select, input { font-size: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background: #eee; }
    h2, h3 { margin-top: 2rem; }
  </style>
</head>
<body>
  <h2>ðŸ¥– Brood Bakery Calculator</h2><label for="recipeSelect">Choose Recipe:</label> <select id="recipeSelect"></select>

  <div>
    <label><input type="radio" name="inputType" value="dough" checked /> Total Dough Weight</label>
    <label><input type="radio" name="inputType" value="flour" /> Flour Only</label>
    <input type="number" id="inputWeight" value="1000" /> g
  </div>  <h3>Ingredients</h3>
  <table id="ingredientsTable">
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Baker's %</th>
        <th>Amount (g)</th>
        <th>Brand</th>
        <th>Cost (THB)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <h3>Extras (per item)</h3>
  <table id="extrasTable">
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Grams per Item</th>
        <th>Brand</th>
        <th>Cost per Item (THB)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <h2 id="totalCost">Total Ingredient Cost: 0 THB</h2>  <script>
    let recipes = [], prices = {}, selectedRecipe = null, inputType = 'dough';

    const recipeSelect = document.getElementById("recipeSelect");
    const inputWeight = document.getElementById("inputWeight");
    const ingredientsTable = document.querySelector("#ingredientsTable tbody");
    const extrasTable = document.querySelector("#extrasTable tbody");
    const totalCostDisplay = document.getElementById("totalCost");

    fetch("recipes.json").then(r => r.json()).then(data => {
      recipes = data;
      data.forEach((r, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = r.name;
        recipeSelect.appendChild(opt);
      });
      selectedRecipe = recipes[0];
      render();
    });

    fetch("ingredientPrices.json").then(r => r.json()).then(data => {
      prices = data;
      render();
    });

    document.querySelectorAll("input[name='inputType']").forEach(r => {
      r.addEventListener("change", e => {
        inputType = e.target.value;
        render();
      });
    });

    recipeSelect.addEventListener("change", e => {
      selectedRecipe = recipes[e.target.value];
      render();
    });

    inputWeight.addEventListener("input", render);

    function render() {
      if (!selectedRecipe || !prices) return;
      const totalWeight = parseFloat(inputWeight.value);
      const flourPercent = selectedRecipe.ingredients.find(i => i.percent === 100)?.percent || 100;
      const totalFlour = inputType === 'flour' ? totalWeight : (totalWeight / selectedRecipe.ingredients.reduce((sum, i) => sum + (i.percent || 0), 0)) * 100;
      let totalCost = 0;
      ingredientsTable.innerHTML = "";

      selectedRecipe.ingredients.forEach(ing => {
        const row = document.createElement("tr");
        const amount = (totalFlour * ing.percent) / 100;
        let brand = "";
        let price = prices[ing.name]?.[brand] || Object.values(prices[ing.name] || {})[0] || 0;
        let cost = (price / 1000) * amount;
        totalCost += cost;

        row.innerHTML = `
          <td>${ing.name}</td>
          <td>${ing.percent}%</td>
          <td>${amount.toFixed(1)}</td>
          <td>${brand}</td>
          <td>${cost.toFixed(2)}</td>
        `;
        ingredientsTable.appendChild(row);
      });

      extrasTable.innerHTML = "";
      selectedRecipe.extras.forEach(extra => {
        const row = document.createElement("tr");
        const brand = "";
        const price = prices[extra.name]?.[brand] || Object.values(prices[extra.name] || {})[0] || 0;
        const grams = extra.perUnitGrams;
        const cost = (price / 1000) * grams;
        row.innerHTML = `
          <td>${extra.name}</td>
          <td>${grams}</td>
          <td>${brand}</td>
          <td>${cost.toFixed(2)}</td>
        `;
        extrasTable.appendChild(row);
      });

      totalCostDisplay.textContent = `Total Ingredient Cost: ${totalCost.toFixed(2)} THB`;
    }
  </script>
<script>
// Clean isolated function to apply brand selection logic
function applyBrandPricing(prices, ingredientName, selectedBrand) {
    if (!prices[ingredientName]) return 0;

    // If brand is "" or not provided, use default price
    if (!selectedBrand || selectedBrand === "") {
        return prices[ingredientName][""] || 0;
    }

    // If brand exists in the list, return the brand's price
    if (prices[ingredientName][selectedBrand]) {
        return prices[ingredientName][selectedBrand];
    }

    // Fallback to default if specific brand not found
    return prices[ingredientName][""] || 0;
}
</script>

</body>
</html>
