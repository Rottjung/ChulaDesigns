<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ¥žBrood Bakery Calculator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>ðŸ¥žBrood Bakery Calculator</h1><label for="recipeSelect">Choose Recipe:</label> <select id="recipeSelect"></select>

  <div>
    <label>Input Type:</label>
    <select id="inputType">
      <option value="dough" selected>Total Dough Weight</option>
      <option value="flour">Flour Only</option>
    </select>
  </div><input type="number" id="inputGrams" value="1000" /> g

  <h2>Ingredients</h2>
  <table id="ingredientsTable">
    <tr>
      <th>Ingredient</th>
      <th>Bakerâ€™s %</th>
      <th>Amount (g)</th>
      <th>Brand</th>
      <th>Cost (THB)</th>
    </tr>
  </table>  <h2>Extras (per item)</h2>
  <table id="extrasTable">
    <tr>
      <th>Ingredient</th>
      <th>Grams per Item</th>
      <th>Brand</th>
      <th>Cost per Item (THB)</th>
    </tr>
  </table>  <h3 id="totalCost">Total Ingredient Cost: 0 THB</h3>  <div id="toast" style="display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#444; color:white; padding:10px; border-radius:5px;">Price updated</div>  <script>
    let recipes = [];
    let ingredientPrices = {};

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.innerText = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 1000);
    }

    function fetchJSON(file) {
      return fetch(file).then(res => {
        if (!res.ok) throw new Error(`${file} not found`);
        return res.json();
      });
    }

    function loadRecipes() {
      fetchJSON('recipes.json').then(data => {
        recipes = data;
        const select = document.getElementById('recipeSelect');
        data.forEach((r, i) => {
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = r.name;
          select.appendChild(opt);
        });
        if (data.length > 0) {
          select.selectedIndex = 0;
          loadSelectedRecipe();
        }
      });
    }

    function loadIngredientPrices() {
      fetchJSON('ingredientPrices.json').then(data => {
        ingredientPrices = data;
      });
    }

    function getPrice(name, brand) {
      const entry = ingredientPrices[name];
      if (!entry) return 0;
      return brand && entry[brand] ? entry[brand] : entry[""] || 0;
    }

    function loadSelectedRecipe() {
      const selected = recipes[document.getElementById('recipeSelect').value];
      const table = document.getElementById('ingredientsTable');
      const extrasTable = document.getElementById('extrasTable');
      const inputType = document.getElementById('inputType').value;
      const grams = parseFloat(document.getElementById('inputGrams').value);

      table.innerHTML = `<tr><th>Ingredient</th><th>Bakerâ€™s %</th><th>Amount (g)</th><th>Brand</th><th>Cost (THB)</th></tr>`;
      extrasTable.innerHTML = `<tr><th>Ingredient</th><th>Grams per Item</th><th>Brand</th><th>Cost per Item (THB)</th></tr>`;

      let flourWeight = grams;
      if (inputType === 'dough') {
        const totalPct = selected.ingredients.reduce((sum, i) => sum + i.percent, 0);
        flourWeight = grams * 100 / totalPct;
      }

      let totalCost = 0;

      selected.ingredients.forEach((ing, i) => {
        const row = table.insertRow();
        row.insertCell().textContent = ing.name;
        row.insertCell().textContent = ing.percent + '%';

        const amount = flourWeight * (ing.percent / 100);
        row.insertCell().textContent = amount.toFixed(1);

        const brandCell = row.insertCell();
        const brandSelect = document.createElement('select');
        brandSelect.innerHTML = ['<option value="">-</option>']
          .concat(Object.keys(ingredientPrices[ing.name] || {}).map(b => `<option value="${b}">${b}</option>`)).join('');
        brandSelect.onchange = () => {
          const price = getPrice(ing.name, brandSelect.value);
          const cost = (amount / 1000) * price;
          row.cells[4].textContent = cost.toFixed(2);
          calcTotalCost();
          showToast("Price updated");
        };
        brandCell.appendChild(brandSelect);

        const costCell = row.insertCell();
        const price = getPrice(ing.name, "");
        const cost = (amount / 1000) * price;
        costCell.textContent = cost.toFixed(2);
        totalCost += cost;
      });

      selected.extras?.forEach(extra => {
        const row = extrasTable.insertRow();
        row.insertCell().textContent = extra.name;
        row.insertCell().textContent = extra.perUnitGrams;

        const brandCell = row.insertCell();
        const brandSelect = document.createElement('select');
        brandSelect.innerHTML = ['<option value="">-</option>']
          .concat(Object.keys(ingredientPrices[extra.name] || {}).map(b => `<option value="${b}">${b}</option>`)).join('');
        brandSelect.onchange = () => {
          const price = getPrice(extra.name, brandSelect.value);
          const cost = (price / 1000) * extra.perUnitGrams;
          row.cells[3].textContent = cost.toFixed(2);
          showToast("Price updated");
        };
        brandCell.appendChild(brandSelect);

        const costCell = row.insertCell();
        const price = getPrice(extra.name, "");
        const cost = (price / 1000) * extra.perUnitGrams;
        costCell.textContent = cost.toFixed(2);
      });

      function calcTotalCost() {
        let total = 0;
        for (let r = 1; r < table.rows.length; r++) {
          const val = parseFloat(table.rows[r].cells[4].textContent);
          total += isNaN(val) ? 0 : val;
        }
        document.getElementById("totalCost").textContent = `Total Ingredient Cost: ${total.toFixed(2)} THB`;
      }
      calcTotalCost();
    }

    document.getElementById('recipeSelect').onchange = loadSelectedRecipe;
    document.getElementById('inputGrams').oninput = loadSelectedRecipe;
    document.getElementById('inputType').onchange = loadSelectedRecipe;

    loadIngredientPrices();
    loadRecipes();
  </script></body>
</html>
