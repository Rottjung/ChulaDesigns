<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brood Bakery Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #fdfaf5;
    }
    h1, h2, h3 {
      color: #333;
    }
    select, input[type="number"] {
      padding: 5px;
      font-size: 1em;
      margin: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f0e6d6;
    }
  </style>
</head>
<body>
  <h1>Brood Bakery Calculator</h1><label for="recipeSelect">Choose Recipe:</label> <select id="recipeSelect"></select>

  <br /><label for="inputType">Input Type:</label> <select id="inputType"> <option value="dough">Total Dough Weight</option> <option value="flour">Flour Only</option> </select> <input type="number" id="inputAmount" value="1000" /> g

  <h2>Ingredients</h2>
  <table id="ingredientTable">
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Baker's %</th>
        <th>Amount (g)</th>
        <th>Brand</th>
        <th>Cost (THB)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <h2>Extras (per item)</h2>
  <table id="extraTable">
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Grams per Item</th>
        <th>Brand</th>
        <th>Cost per Item (THB)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <h3 id="totalCost">Total Ingredient Cost: 0 THB</h3>  <script>
    let recipes = {};
    let prices = {};

    async function loadJSON(path) {
      const response = await fetch(path);
      return await response.json();
    }

    function getBrandOptions(ingredient) {
      if (prices[ingredient]) {
        return Object.keys(prices[ingredient]);
      }
      return [];
    }

    function getPrice(ingredient, grams, brand = "") {
      const brandList = prices[ingredient];
      let pricePerKg = brandList && brandList[brand || ""];
      if (!pricePerKg && brandList) {
        pricePerKg = brandList[Object.keys(brandList)[0]];
      }
      return pricePerKg ? (grams / 1000) * pricePerKg : 0;
    }

    function updateTables() {
      const recipeName = document.getElementById("recipeSelect").value;
      const recipe = recipes[recipeName];
      const inputType = document.getElementById("inputType").value;
      const inputAmount = parseFloat(document.getElementById("inputAmount").value);
      if (!recipe || isNaN(inputAmount)) return;

      const flourWeight =
        inputType === "flour"
          ? inputAmount
          : inputAmount / (1 + recipe.ingredients.reduce((sum, i) => sum + i.percentage / 100, 0));

      const tbody = document.getElementById("ingredientTable").querySelector("tbody");
      tbody.innerHTML = "";
      let totalCost = 0;

      recipe.ingredients.forEach((i) => {
        const amount = flourWeight * (i.percentage / 100);
        const tr = document.createElement("tr");

        const brandList = getBrandOptions(i.name);
        let selectedBrand = i.brand || "";
        let price = getPrice(i.name, amount, selectedBrand);
        totalCost += price;

        tr.innerHTML = `
          <td>${i.name}</td>
          <td>${i.percentage.toFixed(1)}%</td>
          <td>${amount.toFixed(1)}</td>
          <td>${
            brandList.length > 0
              ? `<select onchange="this.parentNode.parentNode.querySelector('[data-role=cost]').textContent = getPrice('${i.name}', ${amount.toFixed(
                  1
                )}, this.value).toFixed(2);">${brandList
                  .map(
                    (b) => `<option value="${b}" ${b === selectedBrand ? "selected" : ""}>${b}</option>`
                  )
                  .join("")}</select>`
              : ""
          }</td>
          <td data-role="cost">${price.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });

      const extraTbody = document.getElementById("extraTable").querySelector("tbody");
      extraTbody.innerHTML = "";
      recipe.extras.forEach((e) => {
        const brandList = getBrandOptions(e.name);
        let selectedBrand = e.brand || "";
        let cost = getPrice(e.name, e.gramsPerItem, selectedBrand);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${e.name}</td>
          <td>${e.gramsPerItem}</td>
          <td>${
            brandList.length > 0
              ? `<select onchange="this.parentNode.parentNode.querySelector('[data-role=cost]').textContent = getPrice('${e.name}', ${
                  e.gramsPerItem
                }, this.value).toFixed(2);">${brandList
                  .map(
                    (b) => `<option value="${b}" ${b === selectedBrand ? "selected" : ""}>${b}</option>`
                  )
                  .join("")}</select>`
              : ""
          }</td>
          <td data-role="cost">${cost.toFixed(2)}</td>
        `;
        extraTbody.appendChild(tr);
      });

      document.getElementById("totalCost").textContent = `Total Ingredient Cost: ${totalCost.toFixed(2)} THB`;
    }

    async function init() {
      recipes = await loadJSON("recipes.json");
      prices = await loadJSON("ingredientPrices.json");

      const recipeSelect = document.getElementById("recipeSelect");
      Object.keys(recipes).forEach((name) => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        recipeSelect.appendChild(option);
      });

      recipeSelect.addEventListener("change", updateTables);
      document.getElementById("inputType").addEventListener("change", updateTables);
      document.getElementById("inputAmount").addEventListener("input", updateTables);

      updateTables();
    }

    init();
  </script></body>
</html>
