<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brood Bakery Calculator</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #fdfcf8; }
    h1 { text-align: center; }
    select, input { padding: 5px; margin: 5px; }
    table { width: 100%; margin-top: 1em; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .section { margin-top: 2em; }
  </style>
</head>
<body>
  <h1>Brood Bakery Calculator</h1>  <div class="section">
    <label for="recipeSelect">Choose Recipe:</label>
    <select id="recipeSelect"></select>
  </div>  <div class="section">
    <label for="inputType">Input Type:</label>
    <select id="inputType">
      <option value="dough">Total Dough Weight</option>
      <option value="flour">Flour Only</option>
    </select>
    <input type="number" id="inputAmount" value="1000" /> g
  </div>  <div class="section">
    <h3>Ingredients</h3>
    <table id="ingredientTable">
      <thead>
        <tr><th>Ingredient</th><th>Amount (g)</th><th>Brand</th><th>Cost (THB)</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <div class="section">
    <h3>Extras (per item)</h3>
    <table id="extraTable">
      <thead>
        <tr><th>Ingredient</th><th>Grams per Item</th><th>Brand</th><th>Cost per Item (THB)</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <div class="section">
    <h2>Total Ingredient Cost: <span id="totalCost">0</span> THB</h2>
  </div>  <script>
    let recipes = [];
    let prices = {};

    async function loadData() {
      const recipeRes = await fetch('recipes.json');
      recipes = await recipeRes.json();

      const priceRes = await fetch('ingredientPrices.json');
      prices = await priceRes.json();

      populateRecipes();
      update();
    }

    function populateRecipes() {
      const recipeSelect = document.getElementById('recipeSelect');
      recipeSelect.innerHTML = '';
      recipes.forEach((r, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = r.name;
        recipeSelect.appendChild(opt);
      });
    }

    function getBrandPrice(ingredient, brand) {
      const item = prices[ingredient];
      if (!item) return 0;
      return brand && item[brand] ? item[brand] : item.default || 0;
    }

    function update() {
      if (recipes.length === 0) return;

      const recipeSelect = document.getElementById('recipeSelect');
      const inputAmount = document.getElementById('inputAmount');
      const inputType = document.getElementById('inputType');
      const ingredientBody = document.querySelector('#ingredientTable tbody');
      const extraBody = document.querySelector('#extraTable tbody');
      const totalCostEl = document.getElementById('totalCost');

      const recipe = recipes[recipeSelect.value];
      const flourWeight = parseFloat(inputAmount.value);
      const inputMode = inputType.value;
      const flourPercent = 100;
      const totalPercent = recipe.ingredients.reduce((acc, i) => acc + i.percent, 0);
      const base = inputMode === 'flour' ? flourWeight / flourPercent : flourWeight / totalPercent * flourPercent;

      ingredientBody.innerHTML = '';
      let total = 0;

      recipe.ingredients.forEach(i => {
        const row = document.createElement('tr');
        const amount = base * i.percent;
        const brandList = Object.keys(prices[i.name] || {}).filter(b => b !== 'default');
        const brand = brandList[0] || '';
        const cost = getBrandPrice(i.name, brand) * amount / 1000;
        total += cost;

        row.innerHTML = `<td>${i.name}</td><td>${amount.toFixed(1)}</td>
          <td>${brand}</td><td>${cost.toFixed(2)}</td>`;
        ingredientBody.appendChild(row);
      });

      extraBody.innerHTML = '';
      if (recipe.extras) {
        recipe.extras.forEach(i => {
          const row = document.createElement('tr');
          const brandList = Object.keys(prices[i.name] || {}).filter(b => b !== 'default');
          const brand = brandList[0] || '';
          const cost = getBrandPrice(i.name, brand) * i.grams / 1000;
          row.innerHTML = `<td>${i.name}</td><td>${i.grams}</td><td>${brand}</td><td>${cost.toFixed(2)}</td>`;
          extraBody.appendChild(row);
          total += cost;
        });
      }

      totalCostEl.textContent = total.toFixed(2);
    }

    document.getElementById('recipeSelect').addEventListener('change', update);
    document.getElementById('inputAmount').addEventListener('input', update);
    document.getElementById('inputType').addEventListener('change', update);

    loadData();
  </script></body>
</html>
